<VirtualHost *:443>
    ServerName mycareer.nj.gov
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/mycareer.2025.cert.pem
    SSLCertificateKeyFile /etc/ssl/private/mycareer.nj.gov.key
    SSLCertificateChainFile /etc/ssl/certs/digicert.chain.pem

    ProxyPreserveHost On
    ProxyVia Full
    <Proxy *>
        Require all granted
    </Proxy>

    # ============================
    # Proxy API to Express backend
    ProxyPass "/api/" "http://localhost:8080/api/"
    ProxyPassReverse "/api/" "http://localhost:8080/api/"

    # Proxy Next.js static assets and public files
    ProxyPass "/_next/" "http://localhost:3000/_next/"
    ProxyPassReverse "/_next/" "http://localhost:3000/_next/"

    ProxyPass "/static/" "http://localhost:3000/static/"
    ProxyPassReverse "/static/" "http://localhost:3000/static/"

    ProxyPass "/favicon.ico" "http://localhost:3000/favicon.ico"
    ProxyPassReverse "/favicon.ico" "http://localhost:3000/favicon.ico"

    ProxyPass "/robots.txt" "http://localhost:3000/robots.txt"
    ProxyPassReverse "/robots.txt" "http://localhost:3000/robots.txt"

    ProxyPass "/stateSeal.png" "http://localhost:3000/stateSeal.png"
    ProxyPassReverse "/stateSeal.png" "http://localhost:3000/stateSeal.png"

    # Everything else to Next.js frontend
    ProxyPass "/" "http://localhost:3000/"
    ProxyPassReverse "/" "http://localhost:3000/"

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
